<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0d6efd">
    <meta name="description" content="Bamburi Tilapia Hotel Employee Management System">
    <title>Bamburi Tilapia Hotel - Employee Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="management.css">
    <!-- Include LZ-String for data compression -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
</head>
<body class="light-mode">
    <div class="container-fluid">
        <header class="bg-primary text-white p-3 mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1>Bamburi Tilapia Hotel</h1>
                    <h2>Employee Management System</h2>
                </div>
                <div>
                    <button id="toggleDarkMode" class="btn btn-sm btn-light">
                        <i class="bi bi-moon-fill"></i> Dark Mode
                    </button>
                    <span id="connectionStatus" class="badge bg-success ms-2">
                        <i class="bi bi-wifi"></i> Online
                    </span>
                </div>
            </div>
        </header>

        <div class="row">
            <!-- Main Navigation -->
            <div class="col-md-3">
                <div class="list-group">
                    <button class="list-group-item list-group-item-action active" data-bs-toggle="tab" data-bs-target="#register">Register Employee</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#attendance">Attendance</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#lateEmployees">Late Employees</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#absentEmployees">Absent Employees</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#leaveDays">Leave/Rest Days</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#salaryCalc">Salary Calculation</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#salaryReports">Salary Reports</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#employeeRecords">Employee Records</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#search">Search Employees</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#deregister">Deregister Employee</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#bulkActions">Bulk Actions</button>
                    <button class="list-group-item list-group-item-action" data-bs-toggle="tab" data-bs-target="#settings">Settings</button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <div class="tab-content">
                    <!-- Register Employee -->
                    <div class="tab-pane fade show active" id="register">
                        <h3>Register New Employee</h3>
                        <form id="employeeForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="empId" class="form-label">Employee ID</label>
                                    <input type="text" class="form-control" id="empId" required>
                                    <small class="text-muted">Can contain any characters</small>
                                </div>
                                <div class="col-md-6">
                                    <label for="fullName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="fullName" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="phoneNumber" class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="phoneNumber" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="shiftType" class="form-label">Shift Type</label>
                                    <select class="form-select" id="shiftType" required>
                                        <option value="">Select Shift</option>
                                        <option value="day">Day Shift (09:30 AM)</option>
                                        <option value="night">Night Shift (09:30 PM)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="workingDays" class="form-label">Working Days per Month</label>
                                    <input type="number" class="form-control" id="workingDays" min="1" max="31" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="agreedSalary" class="form-label">Agreed Salary (Ksh)</label>
                                    <input type="number" class="form-control" id="agreedSalary" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="paymentDay" class="form-label">Payment Day of Month</label>
                                    <input type="number" class="form-control" id="paymentDay" min="1" max="31" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="department" class="form-label">Department</label>
                                    <select class="form-select" id="department" required>
                                        <option value="kitchen">Kitchen</option>
                                        <option value="service">Service</option>
                                        <option value="management">Management</option>
                                        <option value="housekeeping">Housekeeping</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="email" class="form-label">Email (optional)</label>
                                    <input type="email" class="form-control" id="email">
                                </div>
                                <div class="col-md-6">
                                    <label for="photo" class="form-label">Photo (optional)</label>
                                    <input type="file" class="form-control" id="photo" accept="image/*">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Register Employee</button>
                        </form>
                    </div>

                    <!-- Attendance -->
                    <div class="tab-pane fade" id="attendance">
                        <h3>Record Attendance</h3>
                        <div class="alert alert-info">
                            <strong>Quick Actions:</strong>
                            <button class="btn btn-sm btn-success ms-2" id="markAllPresent">
                                <i class="bi bi-check-circle-fill"></i> Mark All Present Today
                            </button>
                            <button class="btn btn-sm btn-warning ms-2" id="markAllLate">
                                <i class="bi bi-exclamation-triangle-fill"></i> Mark All Late Today
                            </button>
                        </div>
                        <form id="attendanceForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="attendanceEmpId" class="form-label">Employee ID</label>
                                    <input type="text" class="form-control" id="attendanceEmpId" required>
                                    <div id="employeeSuggestions" class="suggestions-dropdown"></div>
                                </div>
                                <div class="col-md-6">
                                    <label for="attendanceDate" class="form-label">Date</label>
                                    <input type="date" class="form-control" id="attendanceDate" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="arrivalTime" class="form-label">Arrival Time</label>
                                    <input type="time" class="form-control" id="arrivalTime" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="shiftTypeAttendance" class="form-label">Shift Type</label>
                                    <select class="form-select" id="shiftTypeAttendance" required>
                                        <option value="">Select Shift</option>
                                        <option value="day">Day Shift</option>
                                        <option value="night">Night Shift</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="departureTime" class="form-label">Departure Time</label>
                                    <input type="time" class="form-control" id="departureTime">
                                </div>
                                <div class="col-md-4">
                                    <label for="approvedOvertime" class="form-label">Approved Overtime (mins)</label>
                                    <input type="number" class="form-control" id="approvedOvertime" min="0" value="0">
                                </div>
                                <div class="col-md-4">
                                    <label for="overstayMinutes" class="form-label">Overstay Minutes</label>
                                    <input type="number" class="form-control" id="overstayMinutes" readonly>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Record Attendance</button>
                        </form>
                        <div class="mt-4" id="attendanceStatus"></div>
                    </div>

                    <!-- Late Employees -->
                    <div class="tab-pane fade" id="lateEmployees">
                        <h3>Late Employees</h3>
                        <div class="alert alert-info">
                            Employees who arrived late to work today
                        </div>
                        <div class="mb-3">
                            <button class="btn btn-sm btn-warning" id="notifyLateEmployees">
                                <i class="bi bi-bell-fill"></i> Notify Late Employees
                            </button>
                            <button class="btn btn-sm btn-success ms-2" id="exportLateEmployees">
                                <i class="bi bi-download"></i> Export as CSV
                            </button>
                            <button class="btn btn-sm btn-danger ms-2" id="printLateEmployees">
                                <i class="bi bi-printer-fill"></i> Print
                            </button>
                            <button class="btn btn-sm btn-info ms-2" id="viewLateTrends">
                                <i class="bi bi-graph-up"></i> View Trends
                            </button>
                        </div>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                    <th>Shift</th>
                                    <th>Arrival Time</th>
                                    <th>Minutes Late</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="lateEmployeesList">
                                <!-- Late employees will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Absent Employees -->
                    <div class="tab-pane fade" id="absentEmployees">
                        <h3>Absent Employees</h3>
                        <div class="alert alert-warning">
                            Employees who didn't show up for work today
                        </div>
                        <div class="mb-3">
                            <button class="btn btn-sm btn-warning" id="notifyAbsentEmployees">
                                <i class="bi bi-bell-fill"></i> Notify Absent Employees
                            </button>
                            <button class="btn btn-sm btn-success ms-2" id="exportAbsentEmployees">
                                <i class="bi bi-download"></i> Export as CSV
                            </button>
                            <button class="btn btn-sm btn-danger ms-2" id="printAbsentEmployees">
                                <i class="bi bi-printer-fill"></i> Print
                            </button>
                            <button class="btn btn-sm btn-info ms-2" id="viewAbsentTrends">
                                <i class="bi bi-graph-up"></i> View Trends
                            </button>
                        </div>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                    <th>Shift</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="absentEmployeesList">
                                <!-- Absent employees will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Leave/Rest Days -->
                    <div class="tab-pane fade" id="leaveDays">
                        <h3>Leave/Rest Days</h3>
                        <form id="leaveForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="leaveEmpId" class="form-label">Employee ID</label>
                                    <input type="text" class="form-control" id="leaveEmpId" required>
                                    <div id="leaveEmployeeSuggestions" class="suggestions-dropdown"></div>
                                </div>
                                <div class="col-md-6">
                                    <label for="leaveType" class="form-label">Type</label>
                                    <select class="form-select" id="leaveType" required>
                                        <option value="">Select Type</option>
                                        <option value="paid_leave">Paid Leave</option>
                                        <option value="rest_day">Rest Day</option>
                                        <option value="sick_leave">Sick Leave</option>
                                        <option value="maternity_leave">Maternity Leave</option>
                                        <option value="paternity_leave">Paternity Leave</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="leaveStartDate" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="leaveStartDate" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="leaveEndDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="leaveEndDate" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="leaveReason" class="form-label">Reason (optional)</label>
                                    <textarea class="form-control" id="leaveReason" rows="2"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Leave/Rest Days</button>
                        </form>
                        <div class="mt-4">
                            <div class="mb-3">
                                <button class="btn btn-sm btn-success" id="exportLeaveDays">
                                    <i class="bi bi-download"></i> Export as CSV
                                </button>
                                <button class="btn btn-sm btn-danger ms-2" id="printLeaveDays">
                                    <i class="bi bi-printer-fill"></i> Print
                                </button>
                            </div>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="leaveDaysList">
                                    <!-- Leave/rest days will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Salary Calculation -->
                    <div class="tab-pane fade" id="salaryCalc">
                        <h3>Salary Calculation</h3>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="salaryEmpId" class="form-label">Employee ID</label>
                                <input type="text" class="form-control" id="salaryEmpId">
                                <div id="salaryEmployeeSuggestions" class="suggestions-dropdown"></div>
                            </div>
                            <div class="col-md-6">
                                <label for="calcMonth" class="form-label">Month</label>
                                <input type="month" class="form-control" id="calcMonth">
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="emergencyCalc">
                            <label class="form-check-label" for="emergencyCalc">Emergency Calculation (override payment day)</label>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="includeBonus">
                            <label class="form-check-label" for="includeBonus">Include Performance Bonus</label>
                        </div>
                        <button id="calculateSalaryBtn" class="btn btn-primary">Calculate Salary</button>
                        
                        <div id="salaryResult" class="mt-4 p-3 bg-light rounded d-none">
                            <div class="mb-3">
                                <button class="btn btn-sm btn-success" id="exportSalary">
                                    <i class="bi bi-download"></i> Export as PDF
                                </button>
                                <button class="btn btn-sm btn-danger ms-2" id="printSalary">
                                    <i class="bi bi-printer-fill"></i> Print
                                </button>
                                <button class="btn btn-sm btn-info ms-2" id="sendSalarySlip">
                                    <i class="bi bi-envelope-fill"></i> Email Payslip
                                </button>
                            </div>
                            <h4>Salary Details</h4>
                            <div id="salaryDetails"></div>
                        </div>
                    </div>

                    <!-- Salary Reports -->
                    <div class="tab-pane fade" id="salaryReports">
                        <h3>Salary Reports</h3>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="reportMonth" class="form-label">Select Month</label>
                                <input type="month" class="form-control" id="reportMonth">
                            </div>
                            <div class="col-md-6">
                                <button id="generateReportBtn" class="btn btn-primary mt-4">Generate Report</button>
                                <button id="exportFullReport" class="btn btn-success mt-4 ms-2">
                                    <i class="bi bi-download"></i> Export Full Report
                                </button>
                                <button id="printFullReport" class="btn btn-danger mt-4 ms-2">
                                    <i class="bi bi-printer-fill"></i> Print
                                </button>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Salary Summary</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="salarySummary">
                                            <p>Select a month and generate report to view data</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Pending Payments</h5>
                                    </div>
                                    <div class="card-body">
                                        <div id="pendingPayments">
                                            <p>Select a month and generate report to view data</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">Detailed Salary Report</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped" id="detailedReportTable">
                                        <thead>
                                            <tr>
                                                <th>Employee ID</th>
                                                <th>Name</th>
                                                <th>Base Salary</th>
                                                <th>Deductions</th>
                                                <th>Net Salary</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="detailedReportBody">
                                            <!-- Will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Employee Records -->
                    <div class="tab-pane fade" id="employeeRecords">
                        <h3>Employee Records</h3>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="recordEmpId" class="form-label">Employee ID</label>
                                <input type="text" class="form-control" id="recordEmpId">
                                <div id="recordEmployeeSuggestions" class="suggestions-dropdown"></div>
                            </div>
                            <div class="col-md-6">
                                <button id="fetchRecordsBtn" class="btn btn-primary mt-4">Fetch Records</button>
                                <button id="exportEmployeeRecords" class="btn btn-success mt-4 ms-2">
                                    <i class="bi bi-download"></i> Export as PDF
                                </button>
                                <button id="printEmployeeRecord" class="btn btn-danger mt-4 ms-2">
                                    <i class="bi bi-printer-fill"></i> Print
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">Employee Records</h5>
                            </div>
                            <div class="card-body" id="employeeRecordsBody">
                                <p>Enter employee ID and click "Fetch Records" to view data</p>
                            </div>
                        </div>
                    </div>

                    <!-- Search Employees -->
                    <div class="tab-pane fade" id="search">
                        <h3>Search Employees</h3>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="searchTerm" placeholder="Search by ID or Name">
                                <div id="searchSuggestions" class="suggestions-dropdown"></div>
                            </div>
                            <div class="col-md-6">
                                <button id="searchBtn" class="btn btn-primary">Search</button>
                                <button id="exportAllEmployees" class="btn btn-success ms-2">
                                    <i class="bi bi-download"></i> Export All
                                </button>
                                <button id="printEmployeeDirectory" class="btn btn-danger ms-2">
                                    <i class="bi bi-printer-fill"></i> Print Directory
                                </button>
                            </div>
                        </div>
                        <div id="searchResults" class="mt-3">
                            <!-- Search results will appear here -->
                        </div>
                    </div>

                    <!-- Deregister Employee -->
                    <div class="tab-pane fade" id="deregister">
                        <h3>Deregister Employee</h3>
                        <div class="alert alert-danger">
                            This action will mark the employee as "fired" in the system. Their records will be kept but they will no longer be active.
                        </div>
                        <form id="deregisterForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="deregisterEmpId" class="form-label">Employee ID</label>
                                    <input type="text" class="form-control" id="deregisterEmpId" required>
                                    <div id="deregisterEmployeeSuggestions" class="suggestions-dropdown"></div>
                                </div>
                                <div class="col-md-6">
                                    <label for="deregisterReason" class="form-label">Reason</label>
                                    <select class="form-select" id="deregisterReason" required>
                                        <option value="">Select Reason</option>
                                        <option value="resignation">Resignation</option>
                                        <option value="termination">Termination</option>
                                        <option value="retirement">Retirement</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <label for="deregisterNotes" class="form-label">Notes (optional)</label>
                                    <textarea class="form-control" id="deregisterNotes" rows="3"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-danger">Deregister Employee</button>
                        </form>
                    </div>

                    <!-- Bulk Actions -->
                    <div class="tab-pane fade" id="bulkActions">
                        <h3>Bulk Actions</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Import Employees</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="importFile" class="form-label">Select CSV File</label>
                                            <input class="form-control" type="file" id="importFile" accept=".csv">
                                        </div>
                                        <div class="mb-3">
                                            <button id="importEmployeesBtn" class="btn btn-primary">
                                                <i class="bi bi-upload"></i> Import Employees
                                            </button>
                                            <a href="#" id="downloadTemplate" class="btn btn-link">
                                                <i class="bi bi-download"></i> Download Template
                                            </a>
                                        </div>
                                        <div id="importStatus" class="alert alert-info d-none"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Bulk Attendance</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label for="bulkAttendanceDate" class="form-label">Date</label>
                                            <input type="date" class="form-control" id="bulkAttendanceDate">
                                        </div>
                                        <div class="mb-3">
                                            <label for="bulkAttendanceFile" class="form-label">Select CSV File</label>
                                            <input class="form-control" type="file" id="bulkAttendanceFile" accept=".csv">
                                        </div>
                                        <button id="processBulkAttendanceBtn" class="btn btn-primary">
                                            <i class="bi bi-upload"></i> Process Bulk Attendance
                                        </button>
                                        <div id="bulkAttendanceStatus" class="alert alert-info mt-3 d-none"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings -->
                    <div class="tab-pane fade" id="settings">
                        <h3>System Settings</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Local Storage Management</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label">Storage Usage</label>
                                            <div class="progress mb-2">
                                                <div id="storageUsageBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <small id="storageUsed">0 KB used</small>
                                                <small id="storageRemaining">0 KB remaining</small>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <button id="clearStorageBtn" class="btn btn-danger me-2">
                                                <i class="bi bi-trash"></i> Clear Storage
                                            </button>
                                            <button id="exportDataBtn" class="btn btn-secondary">
                                                <i class="bi bi-download"></i> Export All Data
                                            </button>
                                        </div>
                                        <div class="mb-3">
                                            <button id="importDataBtn" class="btn btn-secondary">
                                                <i class="bi bi-upload"></i> Import Data
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Notification Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="enableNotifications">
                                            <label class="form-check-label" for="enableNotifications">Enable Browser Notifications</label>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="enableEmailNotifications">
                                            <label class="form-check-label" for="enableEmailNotifications">Enable Email Notifications</label>
                                        </div>
                                        <div class="mb-3">
                                            <label for="notificationEmail" class="form-label">Notification Email</label>
                                            <input type="email" class="form-control" id="notificationEmail">
                                        </div>
                                        <button id="saveNotificationSettings" class="btn btn-primary">
                                            <i class="bi bi-save"></i> Save Settings
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Details Modal -->
    <div class="modal fade" id="employeeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="employeeModalTitle">Employee Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="employeeModalBody">
                    <!-- Employee details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveEmployeeChanges">Save Changes</button>
                    <button type="button" class="btn btn-warning" id="editEmployeeIdBtn">Edit ID</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Employee ID Modal -->
    <div class="modal fade" id="editIdModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Employee ID</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editIdForm">
                        <input type="hidden" id="currentEmpId">
                        <div class="mb-3">
                            <label for="newEmpId" class="form-label">New Employee ID</label>
                            <input type="text" class="form-control" id="newEmpId" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Update ID</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Deduction Modal -->
    <div class="modal fade" id="deductionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Deduction</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="deductionForm">
                        <input type="hidden" id="deductionEmpId">
                        <div class="mb-3">
                            <label for="deductionDescription" class="form-label">Description</label>
                            <input type="text" class="form-control" id="deductionDescription" required>
                        </div>
                        <div class="mb-3">
                            <label for="deductionAmount" class="form-label">Amount (Ksh)</label>
                            <input type="number" class="form-control" id="deductionAmount" required>
                        </div>
                        <div class="mb-3">
                            <label for="deductionDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="deductionDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Deduction</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Attendance Modal -->
    <div class="modal fade" id="editAttendanceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Attendance Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editAttendanceForm">
                        <input type="hidden" id="editAttendanceId">
                        <div class="mb-3">
                            <label for="editAttendanceDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="editAttendanceDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="editArrivalTime" class="form-label">Arrival Time</label>
                            <input type="time" class="form-control" id="editArrivalTime" required>
                        </div>
                        <div class="mb-3">
                            <label for="editShiftType" class="form-label">Shift Type</label>
                            <select class="form-select" id="editShiftType" required>
                                <option value="day">Day Shift</option>
                                <option value="night">Night Shift</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editDepartureTime" class="form-label">Departure Time</label>
                            <input type="time" class="form-control" id="editDepartureTime">
                        </div>
                        <div class="mb-3">
                            <label for="editApprovedOvertime" class="form-label">Approved Overtime (mins)</label>
                            <input type="number" class="form-control" id="editApprovedOvertime" min="0" value="0">
                        </div>
                        <div class="mb-3">
                            <label for="editOverstayMinutes" class="form-label">Overstay Minutes</label>
                            <input type="number" class="form-control" id="editOverstayMinutes" readonly>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="button" class="btn btn-danger ms-2" id="deleteAttendanceBtn">Delete Record</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Leave Modal -->
    <div class="modal fade" id="editLeaveModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Leave Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editLeaveForm">
                        <input type="hidden" id="editLeaveId">
                        <div class="mb-3">
                            <label for="editLeaveType" class="form-label">Type</label>
                            <select class="form-select" id="editLeaveType" required>
                                <option value="paid_leave">Paid Leave</option>
                                <option value="rest_day">Rest Day</option>
                                <option value="sick_leave">Sick Leave</option>
                                <option value="maternity_leave">Maternity Leave</option>
                                <option value="paternity_leave">Paternity Leave</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editLeaveStartDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="editLeaveStartDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="editLeaveEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="editLeaveEndDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="editLeaveReason" class="form-label">Reason</label>
                            <textarea class="form-control" id="editLeaveReason" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="button" class="btn btn-danger ms-2" id="deleteLeaveBtn">Delete Record</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Deduction Modal -->
    <div class="modal fade" id="editDeductionModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Deduction</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editDeductionForm">
                        <input type="hidden" id="editDeductionId">
                        <div class="mb-3">
                            <label for="editDeductionDescription" class="form-label">Description</label>
                            <input type="text" class="form-control" id="editDeductionDescription" required>
                        </div>
                        <div class="mb-3">
                            <label for="editDeductionAmount" class="form-label">Amount (Ksh)</label>
                            <input type="number" class="form-control" id="editDeductionAmount" required>
                        </div>
                        <div class="mb-3">
                            <label for="editDeductionDate" class="form-label">Date</label>
                            <input type="date" class="form-control" id="editDeductionDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="button" class="btn btn-danger ms-2" id="deleteDeductionBtn">Delete Deduction</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Trend Graph Modal -->
    <div class="modal fade" id="trendModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="trendModalTitle">Attendance Trends</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="trendStartDate" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="trendStartDate">
                        </div>
                        <div class="col-md-6">
                            <label for="trendEndDate" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="trendEndDate">
                        </div>
                    </div>
                    <div class="mb-3">
                        <button id="generateTrendBtn" class="btn btn-primary">Generate Trend</button>
                        <button id="exportTrendBtn" class="btn btn-success ms-2">Export as Image</button>
                    </div>
                    <canvas id="trendChart" width="400" height="200"></canvas>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Interface -->
    <div class="chatbot-container">
        <button class="btn btn-primary chatbot-toggle" id="chatbotToggle">
            <i class="bi bi-robot"></i> Help Bot
        </button>
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <h5>Employee Help Bot</h5>
                <button class="btn btn-sm btn-close chatbot-close" id="chatbotClose"></button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="chatbot-message bot-message">
                    Hello! I'm your employee help assistant. How can I help you today?
                </div>
            </div>
            <div class="chatbot-input">
                <input type="text" id="chatbotQuery" placeholder="Ask about employees...">
                <button class="btn btn-sm btn-primary" id="sendChatbotQuery">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Offline Alert -->
    <div id="offlineAlert" class="alert alert-warning position-fixed top-0 start-0 w-100 text-center d-none" style="z-index: 1100;">
        <strong>Offline Mode:</strong> You are currently offline. Changes will be saved locally.
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="management.js"></script>
    <script>
        // Check online status
        function updateOnlineStatus() {
            const isOnline = navigator.onLine;
            const connectionStatus = document.getElementById('connectionStatus');
            const offlineAlert = document.getElementById('offlineAlert');
            
            if (isOnline) {
                connectionStatus.className = 'badge bg-success ms-2';
                connectionStatus.innerHTML = '<i class="bi bi-wifi"></i> Online';
                offlineAlert.classList.add('d-none');
            } else {
                connectionStatus.className = 'badge bg-danger ms-2';
                connectionStatus.innerHTML = '<i class="bi bi-wifi-off"></i> Offline';
                offlineAlert.classList.remove('d-none');
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();
    </script>
</body>
</html>
